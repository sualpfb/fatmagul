<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Harita Tahmin Oyunu</title>

    <!-- Senin pembe temana uyacak CSS -->
    <link rel="stylesheet" href="static/styles.css" />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-sA+e2gWkBtV1VzwMcy4R2wwHIdOcX7jDUa2NkxPsa6w="
      crossorigin=""
    />

    <style>
      /* HaritanÄ±n kutusu */
      #map {
        height: 400px;
        border-radius: 8px;
        margin-top: 20px;
      }
      /* SonuÃ§ yazÄ±sÄ± */
      #sonuc {
        margin-top: 20px;
        font-size: 18px;
        font-weight: bold;
        color: white;
        text-shadow: 0 0 5px #000;
      }
      /* Buton */
      #yeni-oyun {
        margin-top: 15px;
        padding: 12px 25px;
        background-color: #ff4d6d;
        color: white;
        font-weight: bold;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        transition: background-color 0.3s ease;
      }
      #yeni-oyun:hover {
        background-color: #e63b5d;
      }
    </style>
</head>
<body>
    <div class="container">
        <h1>Harita Tahmin Oyunu ğŸ—ºï¸</h1>
        <p>
          Rastgele seÃ§ilen bir konum Google Haritalar'da aÃ§Ä±lacak.<br />
          Sen de aÅŸaÄŸÄ±daki haritada tahminini yap, ne kadar yakÄ±n olduÄŸunu gÃ¶r!
        </p>

        <button id="google-harita-btn" class="big-button">Google Haritalar'da Konumu GÃ¶ster</button>

        <div id="map"></div>

        <div id="sonuc"></div>

        <button id="yeni-oyun" style="display:none;">YENÄ° OYUN</button>
    </div>

    <!-- Leaflet JS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-o9N1j6EGeIGTyZ3S7cc0xKMWtD6hNRe+qI4o+rcC3bM="
      crossorigin=""
    ></script>

    <script>
      // Rastgele koordinat Ã¼ret (deniz veya karada olabilir)
      function rastgeleKoordinat() {
        // Enlem: -85 ila 85 arasÄ±nda (kutup dÄ±ÅŸÄ±)
        // Boylam: -180 ila 180 arasÄ±nda
        const lat = (Math.random() * 170) - 85;
        const lng = (Math.random() * 360) - 180;
        return [lat, lng];
      }

      // Haversine formÃ¼lÃ¼ ile iki koordinat arasÄ± mesafe (km)
      function mesafeHesapla(lat1, lon1, lat2, lon2) {
        const R = 6371; // DÃ¼nya yarÄ±Ã§apÄ± km
        const toRad = (deg) => (deg * Math.PI) / 180;

        const dLat = toRad(lat2 - lat1);
        const dLon = toRad(lon2 - lon1);

        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(toRad(lat1)) *
            Math.cos(toRad(lat2)) *
            Math.sin(dLon / 2) *
            Math.sin(dLon / 2);

        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return R * c; // km cinsinden mesafe
      }

      // Puanlama fonksiyonu (mesafeye gÃ¶re)
      function puanHesapla(mesafeKm) {
        // Mesafe 0 ise max 100 puan
        // 0-1000 km arasÄ± lineer azalÄ±yor
        // 1000 km Ã¼stÃ¼ puan 0
        if (mesafeKm < 0) return 0;
        if (mesafeKm > 1000) return 0;
        return Math.round(100 - (mesafeKm / 1000) * 100);
      }

      let hedefKoordinat;
      let tahminMarker;
      let hedefMarker;
      let map;

      function oyunBaslat() {
        hedefKoordinat = rastgeleKoordinat();

        // HaritayÄ± oluÅŸtur
        map = L.map("map").setView([0, 0], 2);

        // Harita katmanÄ± (OpenStreetMap)
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 18,
          attribution:
            'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(map);

        // Ã–nceki markerlar varsa temizle
        if (tahminMarker) map.removeLayer(tahminMarker);
        if (hedefMarker) map.removeLayer(hedefMarker);

        document.getElementById("sonuc").innerHTML = "";
        document.getElementById("yeni-oyun").style.display = "none";

        // Harita tÄ±klama olayÄ±nÄ± ekle
        map.on("click", function (e) {
          if (tahminMarker) {
            alert("Zaten tahmin yaptÄ±n. Yeni oyun iÃ§in 'YENÄ° OYUN' butonuna bas!");
            return;
          }

          const tahmin = e.latlng;
          tahminMarker = L.marker(tahmin).addTo(map).bindPopup("Tahminin").openPopup();

          // Hedef noktayÄ± iÅŸaretle
          hedefMarker = L.marker(hedefKoordinat, {opacity: 0.6})
            .addTo(map)
            .bindPopup("DoÄŸru Konum")
            .openPopup();

          const mesafe = mesafeHesapla(
            tahmin.lat,
            tahmin.lng,
            hedefKoordinat[0],
            hedefKoordinat[1]
          );

          const puan = puanHesapla(mesafe);

          document.getElementById("sonuc").innerHTML = `
            Tahminin, hedef konuma <b>${mesafe.toFixed(2)} km</b> uzaklÄ±kta.<br/>
            PuanÄ±n: <b>${puan}</b> / 100
          `;

          document.getElementById("yeni-oyun").style.display = "inline-block";
        });

        // Google Harita butonuna basÄ±nca hedefi yeni sekmede aÃ§
        document
          .getElementById("google-harita-btn")
          .addEventListener("click", function () {
            const url = `https://www.google.com/maps?q=${hedefKoordinat[0]},${hedefKoordinat[1]}`;
            window.open(url, "_blank");
          });
      }

      // Yeni oyun butonu
      document.getElementById("yeni-oyun").addEventListener("click", () => {
        // HaritayÄ± ve skorlarÄ± sÄ±fÄ±rla
        map.off();
        map.remove();
        oyunBaslat();
      });

      // Sayfa yÃ¼klenince oyunu baÅŸlat
      window.onload = oyunBaslat;
    </script>
</body>
</html>
